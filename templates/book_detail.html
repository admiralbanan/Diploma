{% extends 'base.html' %}

{% block title %}{{ book.title }}{% endblock %}

{% block content %}
<h2>{{ book.title }}</h2>
<p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ book.author }}</p>
<p><strong>–ì–æ–¥:</strong> {{ book.year }}</p>
<p><strong>–ñ–∞–Ω—Ä:</strong> {{ book.genre }}</p>
<p>{{ book.description }}</p>

{% if book.cover %}
<img src="{{ book.cover.url }}" class="img-fluid cover-img mb-3" alt="–û–±–ª–æ–∂–∫–∞">
{% endif %}

<a href="{{ book.file.url }}" class="btn btn-primary mb-3" download>–°–∫–∞—á–∞—Ç—å –∫–Ω–∏–≥—É</a>

<hr>
<h4>–û—Ç–∑—ã–≤—ã</h4>

{% for review in reviews %}
<div class="border p-2 mb-3">
  <p><strong>{{ review.user.username }}</strong> ({{ review.created_at|date:"d.m.Y H:i" }})</p>

  <p>
    {% for _ in review.star_range %}
      ‚≠ê
    {% endfor %}
    {% for _ in review.empty_star_range %}
      ‚òÜ
    {% endfor %}
  </p>

  <p>{{ review.text }}</p>

  <p>
    üëç –ü–æ–ª–µ–∑–Ω–æ: {{ review.likes_count }} |
    üëé –ù–µ –ø–æ–ª–µ–∑–Ω–æ: {{ review.dislikes_count }}
  </p>

  {% if user.is_authenticated %}
  <form method="post" class="d-inline">
    {% csrf_token %}
    <input type="hidden" name="review_id" value="{{ review.id }}">
    <button type="submit" name="like" class="btn btn-sm btn-outline-success">üëç –ü–æ–ª–µ–∑–Ω–æ</button>
    <button type="submit" name="dislike" class="btn btn-sm btn-outline-danger">üëé –ù–µ –ø–æ–ª–µ–∑–Ω–æ</button>
  </form>

  <form method="post" class="mt-2">
    {% csrf_token %}
    <input type="hidden" name="review_id" value="{{ review.id }}">
    <textarea name="comment_text" class="form-control mb-1" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
    <button type="submit" class="btn btn-sm btn-secondary">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
  </form>
  {% endif %}

  <div class="mt-2 ps-2 border-start">
    {% for comment in review.comments.all %}
    <div class="bg-light p-1 mb-1">
      <strong>{{ comment.user.username }}</strong>: {{ comment.text }}
      <small class="text-muted">({{ comment.created_at|date:"d.m.Y H:i" }})</small>
    </div>
    {% empty %}
    <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endfor %}
  </div>
</div>
{% empty %}
<p>–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤.</p>
{% endfor %}

{% if user.is_authenticated %}
<hr>
<h5>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h5>
<form method="post">
  {% csrf_token %}
  <div class="mb-2">
    <textarea name="review_text" class="form-control" placeholder="–í–∞—à –æ—Ç–∑—ã–≤"></textarea>
  </div>
  <div class="mb-2">
    <select name="stars" class="form-select">
      <option value="0">–û—Ü–µ–Ω–∫–∞ (–∑–≤—ë–∑–¥—ã)</option>
      {% for i in "12345"|make_list %}
      <option value="{{ i }}">{{ i }}</option>
      {% endfor %}
    </select>
  </div>
  <button type="submit" class="btn btn-success">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
</form>
{% else %}
<p>–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, <a href="{% url 'login' %}">–≤–æ–π–¥–∏—Ç–µ</a> –Ω–∞ —Å–∞–π—Ç.</p>
{% endif %}
{% endblock %}
